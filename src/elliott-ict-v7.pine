//@version=6
indicator("Elliott + ICT v7", overlay=true, max_labels_count=500, max_lines_count=500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”¥ ELLIOTT WAVE + ICT HYBRID
// Smart Money Concepts meets Wave Theory
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â• INPUTS â•â•â•
grp_main = "ğŸ¯ MAIN SETTINGS"
min_strength = input.int(0, "Min Strength Score (0=all)", minval=0, maxval=9, group=grp_main, tooltip="0 = show all signals in Discount zone. Higher = filter weak setups")
show_signals = input.bool(true, "Show Signals", group=grp_main)

grp_time = "â° KILL ZONES (NY Time)"
use_killzones = input.bool(true, "Only Trade Kill Zones", group=grp_time)
london_start = input.int(2, "London Start", group=grp_time)
london_end = input.int(5, "London End", group=grp_time)
ny_start = input.int(7, "NY Start", group=grp_time)
ny_end = input.int(10, "NY End", group=grp_time)

grp_ict = "ğŸ¦ ICT SETTINGS"
ote_level = input.float(70.5, "OTE Sweet Spot %", minval=60, maxval=80, group=grp_ict)
ob_lookback = input.int(20, "Order Block Lookback", group=grp_ict)
fvg_min_size = input.float(0.1, "FVG Min Size %", group=grp_ict)
displacement_mult = input.float(2.0, "Displacement Multiplier", group=grp_ict)

grp_ew = "ğŸŒŠ ELLIOTT WAVE"
zz_depth = input.int(10, "Zigzag Depth", group=grp_ew)
zz_dev = input.float(2.0, "Zigzag Deviation %", group=grp_ew)
wave_retrace_min = input.float(0.5, "Wave Retrace Min", group=grp_ew)
wave_retrace_max = input.float(0.786, "Wave Retrace Max", group=grp_ew)

grp_tp = "ğŸ’° TARGETS"
tp_fib = input.float(1.618, "Take Profit Fib", group=grp_tp)
sl_pct = input.float(2.0, "Stop Loss %", group=grp_tp)

grp_vis = "ğŸ‘ VISUALS"
show_zigzag = input.bool(true, "Show Zigzag", group=grp_vis)
show_ob = input.bool(true, "Show Order Blocks", group=grp_vis)
show_fvg = input.bool(true, "Show FVG", group=grp_vis)
show_zones = input.bool(true, "Show Premium/Discount", group=grp_vis)
show_stats = input.bool(true, "Show Stats Table", group=grp_vis)
show_confluence = input.bool(true, "Show Confluence Panel", group=grp_vis)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â° KILL ZONE DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Convert to NY timezone (approximate using UTC-5)
utc_hour = hour(time, "UTC")
ny_hour = (utc_hour - 5 + 24) % 24

in_london_kz = ny_hour >= london_start and ny_hour < london_end
in_ny_kz = ny_hour >= ny_start and ny_hour < ny_end
in_any_kz = in_london_kz or in_ny_kz

kz_ok = not use_killzones or in_any_kz

// Background color for Kill Zones
bgcolor(in_london_kz ? color.new(color.blue, 95) : na, title="London KZ")
bgcolor(in_ny_kz ? color.new(color.orange, 95) : na, title="NY KZ")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸŒŠ ZIGZAG (Elliott Wave Structure)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ph = ta.pivothigh(high, zz_depth, zz_depth)
pl = ta.pivotlow(low, zz_depth, zz_depth)

var float[] zzP = array.new_float(0)
var int[] zzB = array.new_int(0)
var int[] zzT = array.new_int(0)
var int dir = 0
var float lastP = 0.0

if not na(ph)
    pb = bar_index - zz_depth
    if dir <= 0 and array.size(zzP) > 0 and dir == -1
        if math.abs(ph - lastP) / lastP * 100 >= zz_dev
            array.push(zzP, ph)
            array.push(zzB, pb)
            array.push(zzT, 1)
            dir := 1
            lastP := ph
    else if dir <= 0 and array.size(zzP) == 0
        array.push(zzP, ph)
        array.push(zzB, pb)
        array.push(zzT, 1)
        dir := 1
        lastP := ph
    else if dir == 1 and ph > lastP and array.size(zzP) > 0
        array.set(zzP, array.size(zzP) - 1, ph)
        array.set(zzB, array.size(zzB) - 1, pb)
        lastP := ph

if not na(pl)
    pb = bar_index - zz_depth
    if dir >= 0 and array.size(zzP) > 0 and dir == 1
        if math.abs(pl - lastP) / lastP * 100 >= zz_dev
            array.push(zzP, pl)
            array.push(zzB, pb)
            array.push(zzT, -1)
            dir := -1
            lastP := pl
    else if dir >= 0 and array.size(zzP) == 0
        array.push(zzP, pl)
        array.push(zzB, pb)
        array.push(zzT, -1)
        dir := -1
        lastP := pl
    else if dir == -1 and pl < lastP and array.size(zzP) > 0
        array.set(zzP, array.size(zzP) - 1, pl)
        array.set(zzB, array.size(zzB) - 1, pb)
        lastP := pl

getPt(i) =>
    sz = array.size(zzP)
    if i < sz
        [array.get(zzP, sz-1-i), array.get(zzB, sz-1-i), array.get(zzT, sz-1-i)]
    else
        [0.0, 0, 0]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š PREMIUM / DISCOUNT / OTE ZONES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[p0, b0, t0] = getPt(0)
[p1, b1, t1] = getPt(1)
[p2, b2, t2] = getPt(2)

var float swing_high = na
var float swing_low = na
var float equilibrium = na
var float ote_price = na

if array.size(zzP) >= 2
    recent_high = math.max(p0, p1)
    recent_low = math.min(p0, p1)
    if recent_high > recent_low
        swing_high := recent_high
        swing_low := recent_low
        equilibrium := (swing_high + swing_low) / 2
        range_size = swing_high - swing_low
        ote_price := swing_high - (range_size * ote_level / 100)

in_discount = not na(equilibrium) and close < equilibrium
in_premium = not na(equilibrium) and close > equilibrium
in_ote_zone = not na(ote_price) and close <= ote_price and close >= swing_low

// Plot zones
plot(show_zones and not na(equilibrium) ? equilibrium : na, "Equilibrium", color=color.gray, style=plot.style_linebr, linewidth=2)
plot(show_zones and not na(ote_price) ? ote_price : na, "OTE Level", color=color.new(#ff6600, 50), style=plot.style_linebr, linewidth=1)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¦ ORDER BLOCK DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var float bull_ob_top = na
var float bull_ob_bot = na
var int bull_ob_bar = na

// Bullish Order Block: Last down candle before big up move
bull_ob_found = false
for i = 1 to ob_lookback
    if close[i] < open[i] and close[i-1] > open[i-1]  // Down candle followed by up
        move_size = (close[i-1] - close[i]) / close[i] * 100
        if move_size > 0.5  // Significant move
            bull_ob_top := high[i]
            bull_ob_bot := low[i]
            bull_ob_bar := bar_index - i
            bull_ob_found := true
            break

in_bull_ob = not na(bull_ob_bot) and close >= bull_ob_bot and close <= bull_ob_top

// Draw Order Block
if show_ob and bull_ob_found and barstate.islast
    box.new(bull_ob_bar, bull_ob_top, bar_index + 5, bull_ob_bot, 
            bgcolor=color.new(color.green, 85), border_color=color.green, border_width=1)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š FAIR VALUE GAP (FVG) DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Bullish FVG: Gap between candle 1 high and candle 3 low
bull_fvg = low[0] > high[2]
bull_fvg_size = bull_fvg ? (low[0] - high[2]) / close * 100 : 0
bull_fvg_valid = bull_fvg and bull_fvg_size >= fvg_min_size

var float fvg_top = na
var float fvg_bot = na
var int fvg_bar = na

if bull_fvg_valid
    fvg_top := low[0]
    fvg_bot := high[2]
    fvg_bar := bar_index - 1

in_fvg = not na(fvg_bot) and close >= fvg_bot and close <= fvg_top

// Draw FVG
if show_fvg and bull_fvg_valid
    box.new(bar_index - 2, low[0], bar_index, high[2], 
            bgcolor=color.new(color.blue, 85), border_color=color.blue, border_width=1)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’¥ DISPLACEMENT DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

atr = ta.atr(14)
candle_size = math.abs(close - open)
displacement = candle_size > atr * displacement_mult

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’§ LIQUIDITY SWEEP DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Check if price swept below recent low then reversed
recent_low_val = ta.lowest(low, 10)[1]
swept_low = low < recent_low_val and close > recent_low_val

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸŒŠ ELLIOTT WAVE 2 DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

wave2_setup = false
wave1_size = 0.0

if p0 > 0 and p1 > 0 and p2 > 0
    if t2 == -1 and t1 == 1 and t0 == -1  // Low-High-Low pattern
        wave1_size := p1 - p2
        if wave1_size > 0
            retrace = (p1 - p0) / wave1_size
            wave2_setup := retrace >= wave_retrace_min and retrace <= wave_retrace_max

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ CONFLUENCE SCORING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Discount is the TRIGGER - required for any signal
// Other factors are STRENGTH multipliers
score_kz = kz_ok ? 1 : 0
score_ote = in_ote_zone ? 2 : 0  // Double weight for OTE
score_ob = in_bull_ob ? 1 : 0
score_fvg = in_fvg ? 1 : 0
score_displacement = displacement[1] or displacement[2] ? 1 : 0  // Recent displacement
score_sweep = swept_low ? 1 : 0
score_wave2 = wave2_setup ? 2 : 0  // Double weight for Elliott

// Strength score (without discount - that's the trigger)
strength_score = score_kz + score_ote + score_ob + score_fvg + score_displacement + score_sweep + score_wave2
// Max strength = 9

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸš€ SIGNAL GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Signal triggers when price enters DISCOUNT zone + bullish candle
// Strength score shows how strong the setup is (0-9)
// Optional: filter by min_strength (0 = show all)
bull_signal = in_discount and close > open and strength_score >= min_strength

var int[] sigB = array.new_int(0)
var float[] sigE = array.new_float(0)
var float[] sigTP = array.new_float(0)
var float[] sigSL = array.new_float(0)
var int[] sigR = array.new_int(0)

var int total = 0
var int wins = 0
var int losses = 0
var int lastSigBar = 0

if bull_signal and (bar_index - lastSigBar) > 10 and show_signals
    lastSigBar := bar_index
    
    entry = close
    tp = entry + (wave1_size > 0 ? wave1_size * tp_fib : entry * tp_fib / 100)
    sl = entry * (1 - sl_pct / 100)
    
    array.push(sigB, bar_index)
    array.push(sigE, entry)
    array.push(sigTP, tp)
    array.push(sigSL, sl)
    array.push(sigR, 0)
    total += 1
    
    // Signal label with strength score
    kz_txt = in_london_kz ? "ğŸ‡¬ğŸ‡§" : in_ny_kz ? "ğŸ‡ºğŸ‡¸" : ""
    lbl = "ğŸ¯ BUY " + kz_txt + "\nğŸ’ª " + str.tostring(strength_score) + "/9"
    col = strength_score >= 6 ? color.new(#00ff88, 0) : strength_score >= 4 ? color.new(#ffcc00, 0) : color.new(#ff6600, 0)
    label.new(bar_index, low, lbl, style=label.style_label_up, color=col, textcolor=color.white, size=size.normal)
    
    // TP/SL lines
    line.new(bar_index, tp, bar_index + 20, tp, color=color.new(#00ff88, 30), width=2, style=line.style_dashed)
    line.new(bar_index, sl, bar_index + 20, sl, color=color.new(#ff4444, 30), width=2, style=line.style_dashed)

// Backtest
if array.size(sigR) > 0
    for i = 0 to array.size(sigR) - 1
        if array.get(sigR, i) == 0
            if high >= array.get(sigTP, i)
                array.set(sigR, i, 1)
                wins += 1
            else if low <= array.get(sigSL, i)
                array.set(sigR, i, -1)
                losses += 1

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”€ DRAW ZIGZAG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if show_zigzag and array.size(zzP) >= 2 and barstate.islast
    for i = 0 to math.min(array.size(zzP) - 2, 15)
        idx = array.size(zzP) - 1 - i
        if idx > 0 and bar_index - array.get(zzB, idx-1) < 500
            col = array.get(zzT, idx) == 1 ? #00ff88 : #ff4444
            line.new(array.get(zzB, idx-1), array.get(zzP, idx-1), array.get(zzB, idx), array.get(zzP, idx), color=col, width=3)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š CONFLUENCE PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if show_confluence
    var table cpanel = table.new(position.bottom_right, 2, 10, bgcolor=color.new(#0d1117, 10), border_width=1)
    
    table.cell(cpanel, 0, 0, "ğŸ¯ SIGNAL", text_color=#00ccff, bgcolor=color.new(#0066cc, 50), text_size=size.small)
    table.cell(cpanel, 1, 0, in_discount ? "ACTIVE" : "WAIT", text_color=in_discount ? #00ff88 : #ff6666, bgcolor=color.new(#0066cc, 50), text_size=size.small)
    
    table.cell(cpanel, 0, 1, "âš¡ DISCOUNT", text_color=in_discount ? #00ff88 : color.gray, text_size=size.tiny)
    table.cell(cpanel, 1, 1, in_discount ? "âœ… TRIGGER" : "âŒ", text_size=size.tiny)
    
    table.cell(cpanel, 0, 2, "ğŸ’ª Strength", text_color=color.white, text_size=size.tiny)
    table.cell(cpanel, 1, 2, str.tostring(strength_score) + "/9", text_color=strength_score >= 6 ? #00ff88 : strength_score >= 4 ? #ffcc00 : #ff6666, text_size=size.tiny)
    
    table.cell(cpanel, 0, 3, "Kill Zone", text_color=color.gray, text_size=size.tiny)
    table.cell(cpanel, 1, 3, kz_ok ? "+1" : "â€”", text_color=kz_ok ? #00ff88 : color.gray, text_size=size.tiny)
    
    table.cell(cpanel, 0, 4, "OTE Zone", text_color=color.gray, text_size=size.tiny)
    table.cell(cpanel, 1, 4, in_ote_zone ? "+2" : "â€”", text_color=in_ote_zone ? #00ff88 : color.gray, text_size=size.tiny)
    
    table.cell(cpanel, 0, 5, "Order Block", text_color=color.gray, text_size=size.tiny)
    table.cell(cpanel, 1, 5, in_bull_ob ? "+1" : "â€”", text_color=in_bull_ob ? #00ff88 : color.gray, text_size=size.tiny)
    
    table.cell(cpanel, 0, 6, "FVG", text_color=color.gray, text_size=size.tiny)
    table.cell(cpanel, 1, 6, in_fvg ? "+1" : "â€”", text_color=in_fvg ? #00ff88 : color.gray, text_size=size.tiny)
    
    table.cell(cpanel, 0, 7, "Displacement", text_color=color.gray, text_size=size.tiny)
    table.cell(cpanel, 1, 7, displacement[1] or displacement[2] ? "+1" : "â€”", text_color=displacement[1] or displacement[2] ? #00ff88 : color.gray, text_size=size.tiny)
    
    table.cell(cpanel, 0, 8, "Liq Sweep", text_color=color.gray, text_size=size.tiny)
    table.cell(cpanel, 1, 8, swept_low ? "+1" : "â€”", text_color=swept_low ? #00ff88 : color.gray, text_size=size.tiny)
    
    table.cell(cpanel, 0, 9, "Wave 2", text_color=color.gray, text_size=size.tiny)
    table.cell(cpanel, 1, 9, wave2_setup ? "+2" : "â€”", text_color=wave2_setup ? #00ff88 : color.gray, text_size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ˆ STATS TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if show_stats
    var table stats = table.new(position.top_right, 2, 6, bgcolor=color.new(#0d1117, 10), border_width=2, border_color=#00ccff)
    
    closed = wins + losses
    rate = closed > 0 ? (wins * 100.0 / closed) : 0.0
    rateCol = rate >= 75 ? #00ff88 : rate >= 60 ? #ffcc00 : #ff4444
    
    table.cell(stats, 0, 0, "ğŸŒŠ ELLIOTT+ICT", text_color=#00ccff, bgcolor=color.new(#0066cc, 50), text_size=size.normal)
    table.cell(stats, 1, 0, timeframe.period, text_color=color.yellow, bgcolor=color.new(#0066cc, 50), text_size=size.normal)
    
    table.cell(stats, 0, 1, "Signals", text_color=color.white, text_size=size.small)
    table.cell(stats, 1, 1, str.tostring(total), text_color=color.white, text_size=size.small)
    
    table.cell(stats, 0, 2, "âœ… Wins", text_color=#00ff88, text_size=size.small)
    table.cell(stats, 1, 2, str.tostring(wins), text_color=#00ff88, text_size=size.small)
    
    table.cell(stats, 0, 3, "âŒ Losses", text_color=#ff4444, text_size=size.small)
    table.cell(stats, 1, 3, str.tostring(losses), text_color=#ff4444, text_size=size.small)
    
    table.cell(stats, 0, 4, "â³ Open", text_color=color.orange, text_size=size.small)
    table.cell(stats, 1, 4, str.tostring(total - closed), text_color=color.orange, text_size=size.small)
    
    table.cell(stats, 0, 5, "ğŸ† WIN RATE", text_color=color.white, bgcolor=color.new(rateCol, 60), text_size=size.normal)
    table.cell(stats, 1, 5, str.tostring(rate, "#.#") + "%", text_color=rateCol, bgcolor=color.new(rateCol, 60), text_size=size.large)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”” ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alertcondition(bull_signal, "Elliott+ICT BUY", "ğŸ¯ Elliott+ICT: High Confluence BUY Signal!")
